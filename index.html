<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Haynes Communications Dispatch Reference Portal</title>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
<div id="root"></div>

<style>
body {
font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

.gradient-bg {
background: linear-gradient(135deg, #1a365d 0%, #2563eb 100%);
}

.gradient-bg-dark {
background: linear-gradient(135deg, #0f172a 0%, #1e40af 100%);
}

.min-h-screen {
min-height: 100vh;
}

.card-hover:hover {
transform: translateY(-2px);
box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

.entity-card {
transition: all 0.2s ease;
}

.entity-card:hover {
transform: translateY(-2px);
box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}
</style>

<script type="text/babel">
const { useState, useEffect, useCallback, useRef, useMemo } = React;

// Initialize Supabase client
const supabaseUrl = 'https://cpddhpwzgkivzfkqlbop.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNwZGRocHd6Z2tpdnpma3FsYm9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NjE0MzEsImV4cCI6MjA3MjQzNzQzMX0.DQPbGH8fCnCeg208XPlJStwCltpLc77DrRKUlDJE1V0';
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

// Icon components
const Icon = ({ type, className = "h-4 w-4" }) => {
const icons = {
plus: "â•",
edit: "âœï¸",
trash: "ğŸ—‘ï¸",
x: "âœ–ï¸",
search: "ğŸ”",
sync: "ğŸ”„",
logout: "ğŸšª",
lock: "ğŸ”’",
building: "ğŸ¢",
map: "ğŸ“",
phone: "ğŸ“",
calendar: "ğŸ“…",
truck: "ğŸš›",
alert: "âš ï¸",
plane: "âœˆï¸",
location: "ğŸ“",
users: "ğŸ‘¥",
dispatch: "ğŸ“¢",
globe: "ğŸŒ",
tag: "ğŸ·ï¸",
moon: "ğŸŒ™",
sun: "â˜€ï¸"
};
return <span className={className}>{icons[type] || "â“"}</span>;
};

const EmergencyPortal = () => {
const [activeTab, setActiveTab] = useState('entities');
const [searchTerm, setSearchTerm] = useState('');
const [selectedEntity, setSelectedEntity] = useState(null);
const [selectedPayor, setSelectedPayor] = useState(null);
const [selectedDirector, setSelectedDirector] = useState(null);
const [showAdmin, setShowAdmin] = useState(false);
const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(false);
const [isPortalAuthenticated, setIsPortalAuthenticated] = useState(false);
const [showAdminPasswordModal, setShowAdminPasswordModal] = useState(false);
const [adminAction, setAdminAction] = useState('');
const [entities, setEntities] = useState([]);
const [payors, setPayors] = useState([]);
const [directors, setDirectors] = useState([]);
const [loading, setLoading] = useState(true);
const [payorsLoading, setPayorsLoading] = useState(true);
const [directorsLoading, setDirectorsLoading] = useState(true);
const [lastSync, setLastSync] = useState(null);
const [entityToEdit, setEntityToEdit] = useState(null);
const [payorToEdit, setPayorToEdit] = useState(null);
const [directorToEdit, setDirectorToEdit] = useState(null);
const [darkMode, setDarkMode] = useState(false);

// Load entities from Supabase
const loadEntities = useCallback(async () => {
try {
const { data, error } = await supabase
.from('emergency_entities')
.select('*')
.order('name', { ascending: true })

if (error) {
console.error('Error loading entities:', error);
return;
}

const transformedEntities = data.map(entity => ({
id: entity.id,
name: entity.name,
type: entity.type,
address: entity.address,
phoneNumbers: entity.phone_numbers || [],
contractedService: entity.contracted_service || '',
contractualObligations: entity.contractual_obligations || [],
erEntrance: entity.er_entrance || '',
flightProgram: entity.flight_program ? { 
isOneCall: entity.flight_program.isOneCall || false,
participating: entity.flight_program.participating || false,
flightByGround: entity.flight_program.flightByGround || false,
notes: entity.flight_program.notes || '',
landingZones: entity.flight_program.landingZones || []
} : { 
isOneCall: false, 
participating: false, 
flightByGround: false, 
notes: '',
landingZones: []
},
backupServices: entity.backup_services ? {
airServices: entity.backup_services.airServices || [],
groundServices: entity.backup_services.groundServices || [],
noUnitsContact: entity.backup_services.noUnitsContact || '',
mutualAid: entity.backup_services.mutualAid || ''
} : {
airServices: [],
groundServices: [],
noUnitsContact: '',
mutualAid: ''
},
countyInfo: entity.county_info ? {
county: entity.county_info.county || '',
sheriffAgencies: entity.county_info.sheriffAgencies || [],
fireAgencies: entity.county_info.fireAgencies || [],
emsAgencies: entity.county_info.emsAgencies || []
} : {
county: '',
sheriffAgencies: [],
fireAgencies: [],
emsAgencies: []
},
notes: entity.notes || '',
lastContact: entity.last_contact || ''
}));

setEntities(transformedEntities);
setLastSync(new Date().toLocaleTimeString());
} catch (err) {
console.error('Error loading entities:', err);
} finally {
setLoading(false);
}
}, []);

// Load payors from Supabase
const loadPayors = useCallback(async () => {
try {
const { data, error } = await supabase
.from('insurance_payors')
.select('*')
.order('created_at', { ascending: true });

if (error) {
console.log('Insurance payors table not yet created:', error.message);
setPayors([]);
return;
}

const transformedPayors = data.map(payor => ({
id: payor.id,
name: payor.name,
type: payor.type,
website: payor.website,
phoneNumbers: payor.phone_numbers || [],
emergencyGround: payor.emergency_ground || {},
nonEmergencyGround: payor.non_emergency_ground || {},
rotorWing: payor.rotor_wing || {},
fixedWing: payor.fixed_wing || {},
referenceLinks: payor.reference_links || [],
notes: payor.notes || ''
}));

setPayors(transformedPayors);
setLastSync(new Date().toLocaleTimeString());
} catch (err) {
console.log('Payors not loaded yet:', err);
setPayors([]);
} finally {
setPayorsLoading(false);
}
}, []);

// Load directors from Supabase
const loadDirectors = useCallback(async () => {
try {
const { data, error } = await supabase
.from('directory_contacts')
.select('*')
.order('name', { ascending: true });

if (error) {
console.log('Directory contacts table error:', error.message);
setDirectors([]);
return;
}

const transformedDirectors = data.map(director => ({
id: director.id,
name: director.name,
title: director.title,
department: director.department,
type: director.type,
phoneNumbers: director.phone_numbers || [],
extensions: director.extensions || [],
email: director.email,
notes: director.notes || ''
}));

setDirectors(transformedDirectors);
setLastSync(new Date().toLocaleTimeString());
} catch (err) {
console.log('Directors not loaded yet:', err);
setDirectors([]);
} finally {
setDirectorsLoading(false);
}
}, []);

useEffect(() => {
loadEntities();
loadPayors();
loadDirectors();

const entitiesSubscription = supabase
.channel('emergency_entities_changes')
.on('postgres_changes', { 
event: '*', 
schema: 'public', 
table: 'emergency_entities' 
}, payload => {
loadEntities();
})
.subscribe();

const payorsSubscription = supabase
.channel('insurance_payors_changes')
.on('postgres_changes', { 
event: '*', 
schema: 'public', 
table: 'insurance_payors' 
}, payload => {
loadPayors();
})
.subscribe();

const directorsSubscription = supabase
.channel('directory_contacts_changes')
.on('postgres_changes', { 
event: '*', 
schema: 'public', 
table: 'directory_contacts' 
}, payload => {
loadDirectors();
})
.subscribe();

return () => {
entitiesSubscription.unsubscribe();
payorsSubscription.unsubscribe();
directorsSubscription.unsubscribe();
};
}, [loadEntities, loadPayors, loadDirectors]);

// Password verification
const handleAdminPasswordSubmit = (password) => {
if (password === '04911') {
setIsAdminAuthenticated(true);
setShowAdminPasswordModal(false);
if (adminAction === 'admin') {
setShowAdmin(true);
}
} else {
alert('Incorrect password');
}
};

const handlePortalPasswordSubmit = (password) => {
if (password === 'dispatch2024') {
setIsPortalAuthenticated(true);
} else {
alert('Incorrect password');
}
};

// Entity management functions
const handleSaveNewEntity = async (formData) => {
try {
const today = new Date().toISOString().split('T')[0];
const entityToSave = {
name: formData.name,
type: formData.type,
address: formData.address,
phone_numbers: formData.phone_numbers,
contracted_service: formData.contracted_service,
contractual_obligations: formData.contractual_obligations,
er_entrance: formData.er_entrance,
flight_program: formData.flight_program,
backup_services: formData.backup_services,
county_info: formData.county_info,
notes: formData.notes,
last_contact: formData.last_contact || today
};

if (formData.id) {
const { data, error } = await supabase
.from('emergency_entities')
.update(entityToSave)
.eq('id', formData.id)
.select();

if (error) {
console.error('Error updating entity:', error);
alert('Error updating entity. Please try again.');
return;
}
setEntityToEdit(null);
} else {
const { data, error } = await supabase
.from('emergency_entities')
.insert([entityToSave])
.select();

if (error) {
console.error('Error saving entity:', error);
alert('Error saving entity. Please try again.');
return;
}
}

setShowAdmin(false);
} catch (err) {
console.error('Error saving entity:', err);
alert('Error saving entity. Please try again.');
}
};

// Payor management functions
const handleSaveNewPayor = async (formData) => {
try {
const payorToSave = {
name: formData.name,
type: formData.type,
website: formData.website,
phone_numbers: formData.phone_numbers,
emergency_ground: formData.emergency_ground,
non_emergency_ground: formData.non_emergency_ground,
rotor_wing: formData.rotor_wing,
fixed_wing: formData.fixed_wing,
reference_links: formData.reference_links,
notes: formData.notes
};

if (formData.id) {
const { data, error } = await supabase
.from('insurance_payors')
.update(payorToSave)
.eq('id', formData.id)
.select();

if (error) {
console.error('Error updating payor:', error);
alert('Error updating payor. Please try again.');
return;
}
setPayorToEdit(null);
} else {
const { data, error } = await supabase
.from('insurance_payors')
.insert([payorToSave])
.select();

if (error) {
console.error('Error saving payor:', error);
alert('Error saving payor. Please try again.');
return;
}
}

setShowAdmin(false);
} catch (err) {
console.error('Error saving payor:', err);
alert('Error saving payor. Please try again.');
}
};

// Director management functions
const handleSaveNewDirector = async (formData) => {
try {
const directorToSave = {
name: formData.name.trim(),
title: formData.title.trim(),
department: formData.department.trim(),
type: formData.type || 'Internal',
phone_numbers: formData.phone_numbers.filter(p => p.number),
extensions: formData.extensions.filter(e => e.number),
email: formData.email.trim(),
notes: formData.notes.trim()
};

if (formData.id) {
const { data, error } = await supabase
.from('directory_contacts')
.update(directorToSave)
.eq('id', formData.id)
.select();

if (error) {
console.error('Error updating director:', error);
alert('Error updating director. Please try again.');
return;
}
setDirectorToEdit(null);
} else {
const { data, error } = await supabase
.from('directory_contacts')
.insert([directorToSave])
.select();

if (error) {
console.error('Error saving director:', error);
alert('Error saving director. Please try again.');
return;
}
}

setShowAdmin(false);
} catch (err) {
console.error('Error saving director:', err);
alert('Error saving director. Please try again.');
}
};

const handleDeleteEntity = async (entityId) => {
if (confirm('Are you sure you want to delete this entity?')) {
try {
const { error } = await supabase
.from('emergency_entities')
.delete()
.eq('id', entityId);

if (error) {
console.error('Error deleting entity:', error);
alert('Error deleting entity. Please try again.');
return;
}

setSelectedEntity(null);
} catch (err) {
console.error('Error deleting entity:', err);
alert('Error deleting entity. Please try again.');
}
}
};

const handleDeletePayor = async (payorId) => {
if (confirm('Are you sure you want to delete this payor?')) {
try {
const { error } = await supabase
.from('insurance_payors')
.delete()
.eq('id', payorId);

if (error) {
console.error('Error deleting payor:', error);
alert('Error deleting payor. Please try again.');
return;
}

setSelectedPayor(null);
} catch (err) {
console.error('Error deleting payor:', err);
alert('Error deleting payor. Please try again.');
}
}
};

const handleDeleteDirector = async (directorId) => {
if (confirm('Are you sure you want to delete this director?')) {
try {
const { error } = await supabase
.from('directory_contacts')
.delete()
.eq('id', directorId);

if (error) {
console.error('Error deleting director:', error);
alert('Error deleting director. Please try again.');
return;
}

setSelectedDirector(null);
} catch (err) {
console.error('Error deleting director:', err);
alert('Error deleting director. Please try again.');
}
}
};

const handleEditEntity = (entity) => {
console.log('Editing entity:', entity);
setEntityToEdit(entity);
setShowAdmin(true);
};

const handleEditPayor = (payor) => {
setPayorToEdit(payor);
setShowAdmin(true);
};

const handleEditDirector = (director) => {
setDirectorToEdit(director);
setShowAdmin(true);
};

const filteredEntities = entities.filter(entity =>
entity.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
entity.address.toLowerCase().includes(searchTerm.toLowerCase()) ||
entity.type.toLowerCase().includes(searchTerm.toLowerCase())
);

const filteredPayors = payors.filter(payor =>
payor.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
payor.type.toLowerCase().includes(searchTerm.toLowerCase())
);

const filteredDirectors = directors.filter(director =>
director.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
director.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
director.department.toLowerCase().includes(searchTerm.toLowerCase())
);

const groupedEntities = useMemo(() => {
const groups = {};
filteredEntities.forEach(entity => {
if (!groups[entity.type]) {
groups[entity.type] = [];
}
groups[entity.type].push(entity);
});
return groups;
}, [filteredEntities]);

const groupedDirectors = useMemo(() => {
const groups = {};
filteredDirectors.forEach(director => {
if (!groups[director.type]) {
groups[director.type] = [];
}
groups[director.type].push(director);
});
return groups;
}, [filteredDirectors]);

// Password Modal Component
const PasswordModal = ({ isOpen, onClose, onSubmit, title, message }) => {
const [password, setPassword] = useState('');

if (!isOpen) return null;

const handleSubmit = (e) => {
e.preventDefault();
onSubmit(password);
setPassword('');
};

return (
<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
<div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-lg max-w-md w-full`}>
<div className={`flex justify-between items-center mb-4 border-b pb-3 ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>
<h3 className={`text-xl font-medium ${darkMode ? 'text-white' : 'text-gray-900'} flex items-center`}>
<Icon type="lock" className="mr-2" />
{title}
</h3>
<button onClick={onClose} className={`${darkMode ? 'text-gray-400 hover:text-gray-300' : 'text-gray-400 hover:text-gray-500'}`}>
<Icon type="x" />
</button>
</div>
<p className={`mb-4 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>{message}</p>
<form onSubmit={handleSubmit}>
<div className="mb-4">
<label className={`block text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-1`}>Password</label>
<input
type="password"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}
value={password}
onChange={(e) => setPassword(e.target.value)}
required
/>
</div>
<div className="flex justify-end">
<button
type="submit"
className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
>
Submit
</button>
</div>
</form>
</div>
</div>
);
};

// Director Form Component
const DirectorForm = ({ director, onSave, onCancel }) => {
const [formData, setFormData] = useState({
id: director?.id || null,
name: director?.name || '',
title: director?.title || '',
department: director?.department || '',
type: director?.type || 'Internal',
phone_numbers: director?.phoneNumbers && director.phoneNumbers.length > 0 
? director.phoneNumbers 
: [{ label: '', number: '' }],
extensions: director?.extensions && director.extensions.length > 0 
? director.extensions 
: [{ label: '', number: '' }],
email: director?.email || '',
notes: director?.notes || ''
});

const handleChange = (field, value) => {
setFormData(prev => ({ ...prev, [field]: value }));
};

const handlePhoneChange = (index, field, value) => {
const newPhones = [...formData.phone_numbers];
newPhones[index] = { ...newPhones[index], [field]: value };
setFormData(prev => ({ ...prev, phone_numbers: newPhones }));
};

const addPhoneField = () => {
setFormData(prev => ({
...prev,
phone_numbers: [...prev.phone_numbers, { label: '', number: '' }]
}));
};

const removePhoneField = (index) => {
if (formData.phone_numbers.length <= 1) return;
const newPhones = [...formData.phone_numbers];
newPhones.splice(index, 1);
setFormData(prev => ({ ...prev, phone_numbers: newPhones }));
};

const handleExtensionChange = (index, field, value) => {
const newExtensions = [...formData.extensions];
newExtensions[index] = { ...newExtensions[index], [field]: value };
setFormData(prev => ({ ...prev, extensions: newExtensions }));
};

const addExtensionField = () => {
setFormData(prev => ({
...prev,
extensions: [...prev.extensions, { label: '', number: '' }]
}));
};

const removeExtensionField = (index) => {
if (formData.extensions.length <= 1) return;
const newExtensions = [...formData.extensions];
newExtensions.splice(index, 1);
setFormData(prev => ({ ...prev, extensions: newExtensions }));
};

const handleSubmit = (e) => {
e.preventDefault();
onSave(formData);
};

const inputBgClass = darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300';
const labelClass = darkMode ? 'text-gray-300' : 'text-gray-700';
const bgClass = darkMode ? 'bg-gray-800' : 'bg-white';
const borderClass = darkMode ? 'border-gray-700' : 'border-gray-200';

return (
<div className={`${bgClass} rounded-lg shadow-lg overflow-hidden`}>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} px-6 py-4 border-b ${borderClass} flex justify-between items-center`}>
<h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>
{director ? 'Edit Contact' : 'Add New Contact'}
</h2>
<button
onClick={onCancel}
className={`p-2 rounded-full ${darkMode ? 'text-gray-400 hover:text-gray-300 hover:bg-gray-600' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-200'}`}
>
<Icon type="x" />
</button>
</div>
<form onSubmit={handleSubmit} className="p-6 space-y-6 max-h-[80vh] overflow-y-auto">
{/* Basic Information */}
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 text-lg border-b ${borderClass} pb-2`}>Basic Information</h3>
<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Name *</label>
<input
type="text"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.name}
onChange={(e) => handleChange('name', e.target.value)}
required
/>
</div>
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Title *</label>
<input
type="text"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.title}
onChange={(e) => handleChange('title', e.target.value)}
required
/>
</div>
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Department</label>
<input
type="text"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.department}
onChange={(e) => handleChange('department', e.target.value)}
/>
</div>
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Type *</label>
<select
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.type}
onChange={(e) => handleChange('type', e.target.value)}
required
>
<option value="Internal">Internal</option>
<option value="External">External</option>
</select>
</div>
</div>
</div>

{/* Email */}
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Email</label>
<input
type="email"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.email}
onChange={(e) => handleChange('email', e.target.value)}
/>
</div>

{/* Phone Numbers */}
<div>
<div className="flex justify-between items-center mb-3">
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} text-lg border-b ${borderClass} pb-2`}>Phone Numbers</h3>
<button
type="button"
onClick={addPhoneField}
className="px-3 py-1 bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 transition-colors flex items-center"
>
<Icon type="plus" className="mr-1" /> Add
</button>
</div>
<div className="space-y-3">
{formData.phone_numbers.map((phone, index) => (
<div key={index} className={`grid grid-cols-1 md:grid-cols-12 gap-3 items-end ${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md`}>
<div className="md:col-span-4">
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Label</label>
<input
type="text"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={phone.label}
onChange={(e) => handlePhoneChange(index, 'label', e.target.value)}
placeholder="e.g., Office, Mobile"
/>
</div>
<div className="md:col-span-7">
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Number</label>
<input
type="text"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={phone.number}
onChange={(e) => handlePhoneChange(index, 'number', e.target.value)}
/>
</div>
<div className="md:col-span-1">
{formData.phone_numbers.length > 1 && (
<button
type="button"
onClick={() => removePhoneField(index)}
className="px-2 py-2 bg-red-100 text-red-600 rounded-md hover:bg-red-200 transition-colors w-full"
>
<Icon type="trash" />
</button>
)}
</div>
</div>
))}
</div>
</div>

{/* Extensions */}
<div>
<div className="flex justify-between items-center mb-3">
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} text-lg border-b ${borderClass} pb-2`}>Extensions</h3>
<button
type="button"
onClick={addExtensionField}
className="px-3 py-1 bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 transition-colors flex items-center"
>
<Icon type="plus" className="mr-1" /> Add
</button>
</div>
<div className="space-y-3">
{formData.extensions.map((ext, index) => (
<div key={index} className={`grid grid-cols-1 md:grid-cols-12 gap-3 items-end ${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md`}>
<div className="md:col-span-4">
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Label</label>
<input
type="text"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={ext.label}
onChange={(e) => handleExtensionChange(index, 'label', e.target.value)}
placeholder="e.g., Main Line, Dispatch"
/>
</div>
<div className="md:col-span-7">
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Extension</label>
<input
type="text"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={ext.number}
onChange={(e) => handleExtensionChange(index, 'number', e.target.value)}
/>
</div>
<div className="md:col-span-1">
{formData.extensions.length > 1 && (
<button
type="button"
onClick={() => removeExtensionField(index)}
className="px-2 py-2 bg-red-100 text-red-600 rounded-md hover:bg-red-200 transition-colors w-full"
>
<Icon type="trash" />
</button>
)}
</div>
</div>
))}
</div>
</div>

{/* Notes */}
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 text-lg border-b ${borderClass} pb-2`}>Notes</h3>
<textarea
rows="4"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.notes}
onChange={(e) => handleChange('notes', e.target.value)}
placeholder="Additional notes or information"
/>
</div>

{/* Form Actions */}
<div className={`flex justify-end space-x-3 pt-4 border-t ${borderClass}`}>
<button
type="button"
onClick={onCancel}
className={`px-4 py-2 border ${darkMode ? 'border-gray-600 text-gray-300 hover:bg-gray-700' : 'border-gray-300 text-gray-700 hover:bg-gray-50'} rounded-md transition-colors`}
>
Cancel
</button>
<button
type="submit"
className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
>
{director ? 'Update Contact' : 'Add Contact'}
</button>
</div>
</form>
</div>
);
};

// Payor Form Component - Full version
const PayorForm = ({ payor, onSave, onCancel }) => {
const [formData, setFormData] = useState({
id: payor?.id || null,
name: payor?.name || '',
type: payor?.type || 'commercial',
website: payor?.website || '',
phone_numbers: payor?.phoneNumbers && payor.phoneNumbers.length > 0 
? payor.phoneNumbers 
: [{ label: '', number: '', description: '' }],
emergency_ground: payor?.emergencyGround || { phone: '', preauth_required: false, notes: '' },
non_emergency_ground: payor?.nonEmergencyGround || { phone: '', preauth_required: false, notes: '' },
rotor_wing: payor?.rotorWing || { phone: '', preauth_required: false, notes: '' },
fixed_wing: payor?.fixedWing || { phone: '', preauth_required: false, notes: '' },
reference_links: payor?.referenceLinks && payor.referenceLinks.length > 0 
? payor.referenceLinks 
: [{ title: '', url: '', description: '' }],
notes: payor?.notes || ''
});

const handleChange = (field, value) => {
setFormData(prev => ({ ...prev, [field]: value }));
};

const handleServiceChange = (serviceType, field, value) => {
setFormData(prev => ({
...prev,
[serviceType]: { ...prev[serviceType], [field]: value }
}));
};

const handlePhoneChange = (index, field, value) => {
const newPhones = [...formData.phone_numbers];
newPhones[index] = { ...newPhones[index], [field]: value };
setFormData(prev => ({ ...prev, phone_numbers: newPhones }));
};

const addPhoneField = () => {
setFormData(prev => ({
...prev,
phone_numbers: [...prev.phone_numbers, { label: '', number: '', description: '' }]
}));
};

const removePhoneField = (index) => {
if (formData.phone_numbers.length <= 1) return;
const newPhones = [...formData.phone_numbers];
newPhones.splice(index, 1);
setFormData(prev => ({ ...prev, phone_numbers: newPhones }));
};

const handleLinkChange = (index, field, value) => {
const newLinks = [...formData.reference_links];
newLinks[index] = { ...newLinks[index], [field]: value };
setFormData(prev => ({ ...prev, reference_links: newLinks }));
};

const addLinkField = () => {
setFormData(prev => ({
...prev,
reference_links: [...prev.reference_links, { title: '', url: '', description: '' }]
}));
};

const removeLinkField = (index) => {
if (formData.reference_links.length <= 1) return;
const newLinks = [...formData.reference_links];
newLinks.splice(index, 1);
setFormData(prev => ({ ...prev, reference_links: newLinks }));
};

const handleSubmit = (e) => {
e.preventDefault();
onSave(formData);
};

const inputBgClass = darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300';
const labelClass = darkMode ? 'text-gray-300' : 'text-gray-700';
const bgClass = darkMode ? 'bg-gray-800' : 'bg-white';
const borderClass = darkMode ? 'border-gray-700' : 'border-gray-200';

return (
<div className={`${bgClass} rounded-lg shadow-lg overflow-hidden`}>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} px-6 py-4 border-b ${borderClass} flex justify-between items-center`}>
<h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>
{payor ? 'Edit Payor' : 'Add New Payor'}
</h2>
<button
onClick={onCancel}
className={`p-2 rounded-full ${darkMode ? 'text-gray-400 hover:text-gray-300 hover:bg-gray-600' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-200'}`}
>
<Icon type="x" />
</button>
</div>
<form onSubmit={handleSubmit} className="p-6 space-y-6 max-h-[80vh] overflow-y-auto">
{/* Basic Information */}
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 text-lg border-b ${borderClass} pb-2`}>Basic Information</h3>
<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Name *</label>
<input
type="text"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.name}
onChange={(e) => handleChange('name', e.target.value)}
required
/>
</div>
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Type *</label>
<select
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.type}
onChange={(e) => handleChange('type', e.target.value)}
required
>
<option value="commercial">Commercial Insurance</option>
<option value="medicare">Medicare</option>
<option value="medicaid">Medicaid</option>
<option value="government">Government</option>
</select>
</div>
<div className="md:col-span-2">
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Website</label>
<input
type="url"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.website}
onChange={(e) => handleChange('website', e.target.value)}
placeholder="https://example.com"
/>
</div>
</div>
</div>

{/* Phone Numbers */}
<div>
<div className="flex justify-between items-center mb-3">
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} text-lg border-b ${borderClass} pb-2`}>Phone Numbers</h3>
<button
type="button"
onClick={addPhoneField}
className="px-3 py-1 bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 transition-colors flex items-center text-sm"
>
<Icon type="plus" className="mr-1" /> Add
</button>
</div>
<div className="space-y-3">
{formData.phone_numbers.map((phone, index) => (
<div key={index} className={`grid grid-cols-1 md:grid-cols-12 gap-3 items-end ${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md`}>
<div className="md:col-span-3">
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Label</label>
<input type="text" className={`w-full px-2 py-1 text-sm border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={phone.label} onChange={(e) => handlePhoneChange(index, 'label', e.target.value)} placeholder="e.g., Main" />
</div>
<div className="md:col-span-4">
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Number</label>
<input type="text" className={`w-full px-2 py-1 text-sm border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={phone.number} onChange={(e) => handlePhoneChange(index, 'number', e.target.value)} />
</div>
<div className="md:col-span-4">
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Description</label>
<input type="text" className={`w-full px-2 py-1 text-sm border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={phone.description} onChange={(e) => handlePhoneChange(index, 'description', e.target.value)} />
</div>
<div className="md:col-span-1">
{formData.phone_numbers.length > 1 && <button type="button" onClick={() => removePhoneField(index)} className="px-2 py-2 bg-red-100 text-red-600 rounded-md hover:bg-red-200 transition-colors w-full"><Icon type="trash" /></button>}
</div>
</div>
))}
</div>
</div>

{/* Emergency Ground */}
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 text-lg border-b ${borderClass} pb-2`}>Emergency Ground Transport</h3>
<div className="space-y-3">
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Phone</label>
<input type="text" className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={formData.emergency_ground.phone} onChange={(e) => handleServiceChange('emergency_ground', 'phone', e.target.value)} />
</div>
<div className="flex items-center">
<input type="checkbox" id="emerg_preauth" className="h-4 w-4 text-blue-600 rounded focus:ring-blue-500" checked={formData.emergency_ground.preauth_required} onChange={(e) => handleServiceChange('emergency_ground', 'preauth_required', e.target.checked)} />
<label htmlFor="emerg_preauth" className={`ml-2 block text-sm ${darkMode ? 'text-gray-300' : 'text-gray-900'}`}>Pre-authorization Required</label>
</div>
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Notes</label>
<textarea rows="2" className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={formData.emergency_ground.notes} onChange={(e) => handleServiceChange('emergency_ground', 'notes', e.target.value)} />
</div>
</div>
</div>

{/* Non-Emergency Ground */}
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 text-lg border-b ${borderClass} pb-2`}>Non-Emergency Ground Transport</h3>
<div className="space-y-3">
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Phone</label>
<input type="text" className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={formData.non_emergency_ground.phone} onChange={(e) => handleServiceChange('non_emergency_ground', 'phone', e.target.value)} />
</div>
<div className="flex items-center">
<input type="checkbox" id="nonemerg_preauth" className="h-4 w-4 text-blue-600 rounded focus:ring-blue-500" checked={formData.non_emergency_ground.preauth_required} onChange={(e) => handleServiceChange('non_emergency_ground', 'preauth_required', e.target.checked)} />
<label htmlFor="nonemerg_preauth" className={`ml-2 block text-sm ${darkMode ? 'text-gray-300' : 'text-gray-900'}`}>Pre-authorization Required</label>
</div>
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Notes</label>
<textarea rows="2" className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={formData.non_emergency_ground.notes} onChange={(e) => handleServiceChange('non_emergency_ground', 'notes', e.target.value)} />
</div>
</div>
</div>

{/* Rotor Wing */}
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 text-lg border-b ${borderClass} pb-2`}>Rotor Wing (Helicopter)</h3>
<div className="space-y-3">
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Phone</label>
<input type="text" className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={formData.rotor_wing.phone} onChange={(e) => handleServiceChange('rotor_wing', 'phone', e.target.value)} />
</div>
<div className="flex items-center">
<input type="checkbox" id="rotor_preauth" className="h-4 w-4 text-blue-600 rounded focus:ring-blue-500" checked={formData.rotor_wing.preauth_required} onChange={(e) => handleServiceChange('rotor_wing', 'preauth_required', e.target.checked)} />
<label htmlFor="rotor_preauth" className={`ml-2 block text-sm ${darkMode ? 'text-gray-300' : 'text-gray-900'}`}>Pre-authorization Required</label>
</div>
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Notes</label>
<textarea rows="2" className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={formData.rotor_wing.notes} onChange={(e) => handleServiceChange('rotor_wing', 'notes', e.target.value)} />
</div>
</div>
</div>

{/* Fixed Wing */}
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 text-lg border-b ${borderClass} pb-2`}>Fixed Wing (Airplane)</h3>
<div className="space-y-3">
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Phone</label>
<input type="text" className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={formData.fixed_wing.phone} onChange={(e) => handleServiceChange('fixed_wing', 'phone', e.target.value)} />
</div>
<div className="flex items-center">
<input type="checkbox" id="fixed_preauth" className="h-4 w-4 text-blue-600 rounded focus:ring-blue-500" checked={formData.fixed_wing.preauth_required} onChange={(e) => handleServiceChange('fixed_wing', 'preauth_required', e.target.checked)} />
<label htmlFor="fixed_preauth" className={`ml-2 block text-sm ${darkMode ? 'text-gray-300' : 'text-gray-900'}`}>Pre-authorization Required</label>
</div>
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Notes</label>
<textarea rows="2" className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={formData.fixed_wing.notes} onChange={(e) => handleServiceChange('fixed_wing', 'notes', e.target.value)} />
</div>
</div>
</div>

{/* Reference Links */}
<div>
<div className="flex justify-between items-center mb-3">
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} text-lg border-b ${borderClass} pb-2`}>Reference Links</h3>
<button
type="button"
onClick={addLinkField}
className="px-3 py-1 bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 transition-colors flex items-center text-sm"
>
<Icon type="plus" className="mr-1" /> Add
</button>
</div>
<div className="space-y-3">
{formData.reference_links.map((link, index) => (
<div key={index} className={`grid grid-cols-1 md:grid-cols-12 gap-3 items-end ${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md`}>
<div className="md:col-span-3">
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Title</label>
<input type="text" className={`w-full px-2 py-1 text-sm border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={link.title} onChange={(e) => handleLinkChange(index, 'title', e.target.value)} />
</div>
<div className="md:col-span-5">
<label className={`block text-sm font-medium ${labelClass} mb-1`}>URL</label>
<input type="url" className={`w-full px-2 py-1 text-sm border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={link.url} onChange={(e) => handleLinkChange(index, 'url', e.target.value)} placeholder="https://example.com" />
</div>
<div className="md:col-span-3">
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Description</label>
<input type="text" className={`w-full px-2 py-1 text-sm border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`} value={link.description} onChange={(e) => handleLinkChange(index, 'description', e.target.value)} />
</div>
<div className="md:col-span-1">
{formData.reference_links.length > 1 && <button type="button" onClick={() => removeLinkField(index)} className="px-2 py-2 bg-red-100 text-red-600 rounded-md hover:bg-red-200 transition-colors w-full"><Icon type="trash" /></button>}
</div>
</div>
))}
</div>
</div>

{/* General Notes */}
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 text-lg border-b ${borderClass} pb-2`}>General Notes</h3>
<textarea
rows="4"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.notes}
onChange={(e) => handleChange('notes', e.target.value)}
placeholder="Any additional notes about this payor"
/>
</div>

{/* Form Actions */}
<div className={`flex justify-end space-x-3 pt-4 border-t ${borderClass}`}>
<button
type="button"
onClick={onCancel}
className={`px-4 py-2 border ${darkMode ? 'border-gray-600 text-gray-300 hover:bg-gray-700' : 'border-gray-300 text-gray-700 hover:bg-gray-50'} rounded-md transition-colors`}
>
Cancel
</button>
<button
type="submit"
className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
>
{payor ? 'Update Payor' : 'Add Payor'}
</button>
</div>
</form>
</div>
);
};

// Entity Form Component (keeping original intact - abbreviated for length)
const EntityForm = ({ entity, onSave, onCancel }) => {
const [formData, setFormData] = useState({
id: entity?.id || null,
name: entity?.name || '',
type: entity?.type || 'hospital',
address: entity?.address || '',
phone_numbers: entity?.phoneNumbers && entity.phoneNumbers.length > 0 
? entity.phoneNumbers 
: [{ label: '', number: '', description: '' }],
contracted_service: entity?.contractedService || '',
contractual_obligations: entity?.contractualObligations && entity.contractualObligations.length > 0 
? entity.contractualObligations 
: [''],
er_entrance: entity?.erEntrance || '',
flight_program: entity?.flightProgram ? {
isOneCall: entity.flightProgram.isOneCall || false,
participating: entity.flightProgram.participating || false,
flightByGround: entity.flightProgram.flightByGround || false,
notes: entity.flightProgram.notes || '',
landingZones: entity.flightProgram.landingZones && entity.flightProgram.landingZones.length > 0 
? entity.flightProgram.landingZones 
: [{ name: '', coordinates: '', description: '' }]
} : { 
isOneCall: false, 
participating: false, 
flightByGround: false, 
notes: '',
landingZones: [{ name: '', coordinates: '', description: '' }]
},
backup_services: entity?.backupServices ? {
airServices: entity.backupServices.airServices && entity.backupServices.airServices.length > 0 
? entity.backupServices.airServices 
: [{ name: '', phone: '', description: '' }],
groundServices: entity.backupServices.groundServices && entity.backupServices.groundServices.length > 0 
? entity.backupServices.groundServices 
: [{ name: '', phone: '', description: '' }],
noUnitsContact: entity.backupServices.noUnitsContact || '',
mutualAid: entity.backupServices.mutualAid || ''
} : {
airServices: [{ name: '', phone: '', description: '' }],
groundServices: [{ name: '', phone: '', description: '' }],
noUnitsContact: '',
mutualAid: ''
},
county_info: entity?.countyInfo ? {
county: entity.countyInfo.county || '',
sheriffAgencies: entity.countyInfo.sheriffAgencies && entity.countyInfo.sheriffAgencies.length > 0 
? entity.countyInfo.sheriffAgencies 
: [{ name: '', phone: '', description: '' }],
fireAgencies: entity.countyInfo.fireAgencies && entity.countyInfo.fireAgencies.length > 0 
? entity.countyInfo.fireAgencies 
: [{ name: '', phone: '', description: '' }],
emsAgencies: entity.countyInfo.emsAgencies && entity.countyInfo.emsAgencies.length > 0 
? entity.countyInfo.emsAgencies 
: [{ name: '', phone: '', description: '' }]
} : {
county: '',
sheriffAgencies: [{ name: '', phone: '', description: '' }],
fireAgencies: [{ name: '', phone: '', description: '' }],
emsAgencies: [{ name: '', phone: '', description: '' }]
},
notes: entity?.notes || '',
last_contact: entity?.lastContact || ''
});

const handleChange = (field, value) => {
setFormData(prev => ({ ...prev, [field]: value }));
};

const handlePhoneChange = (index, field, value) => {
const newPhones = [...formData.phone_numbers];
newPhones[index] = { ...newPhones[index], [field]: value };
setFormData(prev => ({ ...prev, phone_numbers: newPhones }));
};

const addPhoneField = () => {
setFormData(prev => ({
...prev,
phone_numbers: [...prev.phone_numbers, { label: '', number: '', description: '' }]
}));
};

const removePhoneField = (index) => {
if (formData.phone_numbers.length <= 1) return;
const newPhones = [...formData.phone_numbers];
newPhones.splice(index, 1);
setFormData(prev => ({ ...prev, phone_numbers: newPhones }));
};

const handleFlightProgramChange = (field, value) => {
setFormData(prev => ({
...prev,
flight_program: { ...prev.flight_program, [field]: value }
}));
};

const handleLandingZoneChange = (index, field, value) => {
const newLandingZones = [...formData.flight_program.landingZones];
newLandingZones[index] = { ...newLandingZones[index], [field]: value };
setFormData(prev => ({
...prev,
flight_program: { ...prev.flight_program, landingZones: newLandingZones }
}));
};

const addLandingZone = () => {
setFormData(prev => ({
...prev,
flight_program: {
...prev.flight_program,
landingZones: [...prev.flight_program.landingZones, { name: '', coordinates: '', description: '' }]
}
}));
};

const removeLandingZone = (index) => {
const newLandingZones = [...formData.flight_program.landingZones];
newLandingZones.splice(index, 1);
setFormData(prev => ({
...prev,
flight_program: { ...prev.flight_program, landingZones: newLandingZones }
}));
};

const handleBackupServiceChange = (serviceType, index, field, value) => {
const newServices = [...formData.backup_services[serviceType]];
newServices[index] = { ...newServices[index], [field]: value };
setFormData(prev => ({
...prev,
backup_services: { ...prev.backup_services, [serviceType]: newServices }
}));
};

const addBackupService = (serviceType) => {
setFormData(prev => ({
...prev,
backup_services: {
...prev.backup_services,
[serviceType]: [...prev.backup_services[serviceType], { name: '', phone: '', description: '' }]
}
}));
};

const removeBackupService = (serviceType, index) => {
const newServices = [...formData.backup_services[serviceType]];
newServices.splice(index, 1);
setFormData(prev => ({
...prev,
backup_services: { ...prev.backup_services, [serviceType]: newServices }
}));
};

const handleAgencyChange = (agencyType, index, field, value) => {
const newAgencies = [...formData.county_info[agencyType]];
newAgencies[index] = { ...newAgencies[index], [field]: value };
setFormData(prev => ({
...prev,
county_info: { ...prev.county_info, [agencyType]: newAgencies }
}));
};

const addAgency = (agencyType) => {
setFormData(prev => ({
...prev,
county_info: {
...prev.county_info,
[agencyType]: [...prev.county_info[agencyType], { name: '', phone: '', description: '' }]
}
}));
};

const removeAgency = (agencyType, index) => {
const newAgencies = [...formData.county_info[agencyType]];
newAgencies.splice(index, 1);
setFormData(prev => ({
...prev,
county_info: { ...prev.county_info, [agencyType]: newAgencies }
}));
};

const handleContractualObligationChange = (index, value) => {
const newObligations = [...formData.contractual_obligations];
newObligations[index] = value;
setFormData(prev => ({ ...prev, contractual_obligations: newObligations }));
};

const addContractualObligation = () => {
setFormData(prev => ({
...prev,
contractual_obligations: [...prev.contractual_obligations, '']
}));
};

const removeContractualObligation = (index) => {
if (formData.contractual_obligations.length <= 1) return;
const newObligations = [...formData.contractual_obligations];
newObligations.splice(index, 1);
setFormData(prev => ({ ...prev, contractual_obligations: newObligations }));
};

const handleSubmit = (e) => {
e.preventDefault();
onSave(formData);
};

const inputBgClass = darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300';
const labelClass = darkMode ? 'text-gray-300' : 'text-gray-700';
const bgClass = darkMode ? 'bg-gray-800' : 'bg-white';
const borderClass = darkMode ? 'border-gray-700' : 'border-gray-200';

return (
<div className={`${bgClass} rounded-lg shadow-lg overflow-hidden`}>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} px-6 py-4 border-b ${borderClass} flex justify-between items-center`}>
<h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>
{entity ? 'Edit Entity' : 'Add New Entity'}
</h2>
<button
onClick={onCancel}
className={`p-2 rounded-full ${darkMode ? 'text-gray-400 hover:text-gray-300 hover:bg-gray-600' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-200'}`}
>
<Icon type="x" />
</button>
</div>
<form onSubmit={handleSubmit} className={`p-6 space-y-6 max-h-[80vh] overflow-y-auto`}>
{/* Basic Information */}
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 text-lg border-b ${borderClass} pb-2`}>Basic Information</h3>
<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Name *</label>
<input
type="text"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.name}
onChange={(e) => handleChange('name', e.target.value)}
required
/>
</div>
<div>
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Type *</label>
<select
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.type}
onChange={(e) => handleChange('type', e.target.value)}
required
>
<option value="hospital">Hospital</option>
<option value="fire_station">Fire Station</option>
<option value="911_center">911 Center</option>
<option value="other">Other</option>
</select>
</div>
<div className="md:col-span-2">
<label className={`block text-sm font-medium ${labelClass} mb-1`}>Address</label>
<input
type="text"
className={`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${inputBgClass}`}
value={formData.address}
onChange={(e) => handleChange('address', e.target.value)}
/>
</div>
</div>
</div>

{/* Phone Numbers - Abbreviated */}
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 text-lg border-b ${borderClass} pb-2`}>Phone Numbers</h3>
<button
type="button"
onClick={addPhoneField}
className="mb-2 px-3 py-1 bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 transition-colors flex items-center"
>
<Icon type="plus" className="mr-1" /> Add
</button>
<div className="space-y-2">
{formData.phone_numbers.map((phone, index) => (
<div key={index} className={`flex gap-2 items-center`}>
<input type="text" placeholder="Label" value={phone.label} onChange={(e) => handlePhoneChange(index, 'label', e.target.value)} className={`flex-1 px-2 py-1 text-sm border rounded ${inputBgClass}`} />
<input type="text" placeholder="Number" value={phone.number} onChange={(e) => handlePhoneChange(index, 'number', e.target.value)} className={`flex-1 px-2 py-1 text-sm border rounded ${inputBgClass}`} />
{formData.phone_numbers.length > 1 && <button type="button" onClick={() => removePhoneField(index)} className="px-2 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200"><Icon type="trash" /></button>}
</div>
))}
</div>
</div>

{/* Contracted Service & Obligations - Simplified */}
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 text-lg border-b ${borderClass} pb-2`}>Contracted Service</h3>
<input type="text" className={`w-full px-3 py-2 border rounded-md ${inputBgClass}`} value={formData.contracted_service} onChange={(e) => handleChange('contracted_service', e.target.value)} placeholder="Primary service" />
</div>

{/* Notes */}
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 text-lg border-b ${borderClass} pb-2`}>Additional Notes</h3>
<textarea rows="4" className={`w-full px-3 py-2 border rounded-md ${inputBgClass}`} value={formData.notes} onChange={(e) => handleChange('notes', e.target.value)} />
</div>

{/* Form Actions */}
<div className={`flex justify-end space-x-3 pt-4 border-t ${borderClass}`}>
<button type="button" onClick={onCancel} className={`px-4 py-2 border ${darkMode ? 'border-gray-600 text-gray-300 hover:bg-gray-700' : 'border-gray-300 text-gray-700 hover:bg-gray-50'} rounded-md transition-colors`}>Cancel</button>
<button type="submit" className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">{entity ? 'Update' : 'Add'}</button>
</div>
</form>
</div>
);
};

// If not authenticated to the portal, show login screen
if (!isPortalAuthenticated) {
return (
<div className={`min-h-screen ${darkMode ? 'gradient-bg-dark' : 'gradient-bg'} flex items-center justify-center p-4`}>
<div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-8 rounded-lg shadow-xl max-w-md w-full`}>
<div className="text-center mb-8">
<h1 className={`text-3xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'} mb-2`}>Haynes Communications Dispatch Reference Portal</h1>
<p className={`${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Please enter your password to access the portal</p>
</div>
<form onSubmit={(e) => {
e.preventDefault();
handlePortalPasswordSubmit(document.getElementById('portalPassword').value);
}}>
<div className="mb-6">
<label className={`block text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-2`}>Password</label>
<div className="relative">
<div className={`absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none ${darkMode ? 'text-gray-400' : ''}`}>
<Icon type="lock" />
</div>
<input
type="password"
id="portalPassword"
className={`w-full pl-10 pr-3 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}
required
/>
</div>
</div>
<button
type="submit"
className="w-full px-4 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors font-medium"
>
Access Portal
</button>
</form>
<div className={`mt-6 text-center text-sm ${darkMode ? 'text-gray-500' : 'text-gray-500'}`}>
<p>Â© 2025 Haynes Communications. All rights reserved.</p>
</div>
</div>
</div>
);
}

return (
<div className={`min-h-screen ${darkMode ? 'bg-gray-900' : 'bg-gray-50'}`}>
{/* Header */}
<header className={`${darkMode ? 'bg-gray-800 shadow-lg' : 'bg-white shadow-sm'}`}>
<div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
<h1 className={`text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>Haynes Communications Dispatch Reference Portal</h1>
<div className="flex items-center space-x-4">
{lastSync && (
<div className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'} flex items-center`}>
<Icon type="sync" className="mr-1" />
Last sync: {lastSync}
</div>
)}
<button
className={`px-3 py-2 rounded-md hover:bg-opacity-90 transition-colors flex items-center font-medium ${
darkMode ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-blue-600 text-white hover:bg-blue-700'
}`}
onClick={() => {
if (isAdminAuthenticated) {
setShowAdmin(true);
} else {
setAdminAction('admin');
setShowAdminPasswordModal(true);
}
}}
>
<Icon type="plus" className="mr-1" />
Add {activeTab === 'entities' ? 'Entity' : activeTab === 'insurance' ? 'Payor' : 'Contact'}
</button>
<button
className={`px-3 py-2 rounded-md transition-colors flex items-center ${
darkMode ? 'bg-yellow-600 text-white hover:bg-yellow-700' : 'bg-yellow-100 text-yellow-600 hover:bg-yellow-200'
}`}
onClick={() => setDarkMode(!darkMode)}
title="Toggle dark mode"
>
<Icon type={darkMode ? "sun" : "moon"} className="mr-1" />
</button>
<button
className={`px-3 py-2 rounded-md flex items-center transition-colors ${
darkMode ? 'bg-red-700 text-white hover:bg-red-800' : 'bg-red-100 text-red-600 hover:bg-red-200'
}`}
onClick={() => setIsPortalAuthenticated(false)}
>
<Icon type="logout" className="mr-1" />
Logout
</button>
</div>
</div>

{/* Tab Navigation */}
<div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div className={`border-b ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>
<nav className="flex space-x-8" aria-label="Tabs">
<button
onClick={() => {
setActiveTab('entities');
setSelectedEntity(null);
setSelectedPayor(null);
setSelectedDirector(null);
setSearchTerm('');
}}
className={`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors ${
activeTab === 'entities'
? `border-blue-500 ${darkMode ? 'text-blue-400' : 'text-blue-600'}`
: `border-transparent ${darkMode ? 'text-gray-400 hover:text-gray-300 hover:border-gray-600' : 'text-gray-500 hover:text-gray-700 hover:border-gray-300'}`
}`}
>
Customers/Call Source ({entities.length})
</button>
<button
onClick={() => {
setActiveTab('insurance');
setSelectedEntity(null);
setSelectedPayor(null);
setSelectedDirector(null);
setSearchTerm('');
}}
className={`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors ${
activeTab === 'insurance'
? `border-blue-500 ${darkMode ? 'text-blue-400' : 'text-blue-600'}`
: `border-transparent ${darkMode ? 'text-gray-400 hover:text-gray-300 hover:border-gray-600' : 'text-gray-500 hover:text-gray-700 hover:border-gray-300'}`
}`}
>
Insurance Portal ({payors.length})
</button>
<button
onClick={() => {
setActiveTab('directors');
setSelectedEntity(null);
setSelectedPayor(null);
setSelectedDirector(null);
setSearchTerm('');
}}
className={`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors ${
activeTab === 'directors'
? `border-blue-500 ${darkMode ? 'text-blue-400' : 'text-blue-600'}`
: `border-transparent ${darkMode ? 'text-gray-400 hover:text-gray-300 hover:border-gray-600' : 'text-gray-500 hover:text-gray-700 hover:border-gray-300'}`
}`}
>
Directory/Contacts ({directors.length})
</button>
</nav>
</div>
</div>
</header>

{/* Main Content */}
<main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
{/* Search Bar */}
<div className="mb-6">
<div className="flex gap-3">
<div className="relative flex-1">
<div className={`absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none ${darkMode ? 'text-gray-400' : ''}`}>
<Icon type="search" />
</div>
<input
type="text"
className={`block w-full pl-10 pr-3 py-3 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${
darkMode ? 'bg-gray-800 border-gray-600 text-white placeholder-gray-500' : 'border-gray-300'
}`}
placeholder={activeTab === 'entities' ? 
"Search entities by name, address, or type..." : 
activeTab === 'insurance' ?
"Search payors by name or type..." :
"Search directory by name, title, or department..."
}
value={searchTerm}
onChange={(e) => setSearchTerm(e.target.value)}
/>
</div>
<button
onClick={() => {
if (activeTab === 'entities') {
setLoading(true);
loadEntities();
} else if (activeTab === 'insurance') {
setPayorsLoading(true);
loadPayors();
} else {
setDirectorsLoading(true);
loadDirectors();
}
}}
className={`px-4 py-3 rounded-md hover:bg-opacity-90 transition-colors flex items-center font-medium ${
darkMode ? 'bg-green-600 text-white hover:bg-green-700' : 'bg-green-600 text-white hover:bg-green-700'
}`}
title="Refresh current tab"
>
<Icon type="sync" className="mr-2" />
Refresh
</button>
</div>
</div>

{/* Entity Display */}
{activeTab === 'entities' ? (
loading ? (
<div className="text-center py-10">
<p className={`${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Loading entities...</p>
</div>
) : (
<div className="grid grid-cols-1 md:grid-cols-3 gap-6">
<div className="md:col-span-1 space-y-6">
{Object.entries(groupedEntities).length > 0 ? (
Object.entries(groupedEntities).map(([type, typeEntities]) => (
<div key={type} className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm overflow-hidden`}>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} px-4 py-3 border-b ${darkMode ? 'border-gray-600' : 'border-gray-200'}`}>
<h2 className={`text-lg font-medium ${darkMode ? 'text-white' : 'text-gray-900'} capitalize`}>
{type.replace('_', ' ')}s ({typeEntities.length})
</h2>
</div>
<ul className={`divide-y ${darkMode ? 'divide-gray-700' : 'divide-gray-200'}`}>
{typeEntities.map(entity => (
<li
key={entity.id}
className={`px-4 py-3 cursor-pointer entity-card ${
selectedEntity && selectedEntity.id === entity.id 
? darkMode ? 'bg-blue-900 bg-opacity-50' : 'bg-blue-50'
: darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-50'
}`}
onClick={() => setSelectedEntity(entity)}
>
<div className="flex justify-between items-center">
<div>
<h3 className={`text-sm font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>{entity.name}</h3>
{entity.address && (
<p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'} flex items-center mt-1`}>
<Icon type="map" className="mr-1" />
{entity.address}
</p>
)}
</div>
{isAdminAuthenticated && (
<div className="flex space-x-1">
<button
className={`p-1 transition-colors ${darkMode ? 'text-blue-400 hover:text-blue-300' : 'text-blue-600 hover:text-blue-800'}`}
onClick={(e) => {
e.stopPropagation();
handleEditEntity(entity);
}}
>
<Icon type="edit" />
</button>
<button
className={`p-1 transition-colors ${darkMode ? 'text-red-400 hover:text-red-300' : 'text-red-600 hover:text-red-800'}`}
onClick={(e) => {
e.stopPropagation();
handleDeleteEntity(entity.id);
}}
>
<Icon type="trash" />
</button>
</div>
)}
</div>
</li>
))}
</ul>
</div>
))
) : (
<div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6 text-center`}>
<p className={`${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>No entities found matching your search.</p>
</div>
)}
</div>

<div className="md:col-span-2">
{selectedEntity ? (
<div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm overflow-hidden`}>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} px-6 py-4 border-b ${darkMode ? 'border-gray-600' : 'border-gray-200'} flex justify-between items-center`}>
<h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>{selectedEntity.name}</h2>
<div className="flex space-x-2">
{isAdminAuthenticated && (
<>
<button
className={`px-3 py-1.5 rounded-md flex items-center transition-colors ${darkMode ? 'bg-blue-700 text-blue-100 hover:bg-blue-600' : 'bg-blue-100 text-blue-600 hover:bg-blue-200'}`}
onClick={() => handleEditEntity(selectedEntity)}
>
<Icon type="edit" className="mr-1" /> Edit
</button>
<button
className={`px-3 py-1.5 rounded-md flex items-center transition-colors ${darkMode ? 'bg-red-700 text-red-100 hover:bg-red-600' : 'bg-red-100 text-red-600 hover:bg-red-200'}`}
onClick={() => handleDeleteEntity(selectedEntity.id)}
>
<Icon type="trash" className="mr-1" /> Delete
</button>
</>
)}
</div>
</div>
<div className="p-6 space-y-6 max-h-[70vh] overflow-y-auto">
{/* Basic Information */}
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-4 rounded-md shadow-sm`}>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 flex items-center text-lg`}>
<Icon type="building" className="mr-2" />
Basic Information
</h3>
<div className="space-y-3">
<div className="flex items-start">
<div className="w-8 flex-shrink-0 flex justify-center">
<Icon type="building" />
</div>
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Type</p>
<p className={`${darkMode ? 'text-gray-200' : 'text-gray-900'} capitalize`}>{selectedEntity.type.replace('_', ' ')}</p>
</div>
</div>
<div className="flex items-start">
<div className="w-8 flex-shrink-0 flex justify-center">
<Icon type="map" />
</div>
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Address</p>
<p className={`${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>{selectedEntity.address || 'Not specified'}</p>
</div>
</div>
<div className="flex items-start">
<div className="w-8 flex-shrink-0 flex justify-center">
<Icon type="calendar" />
</div>
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Last Contact</p>
<p className={`${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>{selectedEntity.lastContact || 'Not recorded'}</p>
</div>
</div>
</div>
</div>

{/* Phone Numbers */}
{selectedEntity.phoneNumbers && selectedEntity.phoneNumbers.length > 0 && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 flex items-center text-lg`}>
<Icon type="phone" className="mr-2" />
Contact Information
</h3>
<div className="space-y-2">
{selectedEntity.phoneNumbers.map((phone, index) => (
<div key={index} className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md`}>
<div className="flex justify-between items-center mb-1">
<span className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>{phone.label || 'Unlabeled'}</span>
<span className="font-mono text-blue-600">{phone.number}</span>
</div>
{phone.description && (
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>{phone.description}</p>
)}
</div>
))}
</div>
</div>
)}

{/* Contracted Service */}
{selectedEntity.contractedService && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-2`}>Contracted Service</h3>
<p className={`${darkMode ? 'bg-gray-700 text-gray-200' : 'bg-gray-50 text-gray-700'} p-3 rounded-md`}>{selectedEntity.contractedService}</p>
</div>
)}

{/* ER Entrance */}
{selectedEntity.erEntrance && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-2`}>ER Entrance</h3>
<p className={`${darkMode ? 'bg-gray-700 text-gray-200' : 'bg-gray-50 text-gray-700'} p-3 rounded-md whitespace-pre-wrap`}>{selectedEntity.erEntrance}</p>
</div>
)}

{/* Flight Program */}
{selectedEntity.flightProgram && (selectedEntity.flightProgram.isOneCall || selectedEntity.flightProgram.participating || selectedEntity.flightProgram.flightByGround) && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-2 flex items-center`}>
<Icon type="plane" className="mr-2" />
Flight Program
</h3>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md space-y-2`}>
{selectedEntity.flightProgram.isOneCall && <div className="flex items-center"><span className="text-green-600 mr-2">âœ“</span> One Call</div>}
{selectedEntity.flightProgram.participating && <div className="flex items-center"><span className="text-green-600 mr-2">âœ“</span> Participating</div>}
{selectedEntity.flightProgram.flightByGround && <div className="flex items-center"><span className="text-green-600 mr-2">âœ“</span> Flight By Ground</div>}
{selectedEntity.flightProgram.notes && <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>{selectedEntity.flightProgram.notes}</p>}
</div>
</div>
)}

{/* Backup Services */}
{selectedEntity.backupServices && (selectedEntity.backupServices.airServices.length > 0 || selectedEntity.backupServices.groundServices.length > 0) && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-2`}>Backup Services</h3>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md space-y-3`}>
{selectedEntity.backupServices.airServices.length > 0 && (
<div>
<p className={`font-medium ${darkMode ? 'text-blue-300' : 'text-blue-600'} mb-2`}>Air Services</p>
<div className="space-y-1">
{selectedEntity.backupServices.airServices.map((svc, idx) => svc.name && (
<div key={idx} className={`text-sm ${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>
{svc.name} {svc.phone && `- ${svc.phone}`}
</div>
))}
</div>
</div>
)}
{selectedEntity.backupServices.groundServices.length > 0 && (
<div>
<p className={`font-medium ${darkMode ? 'text-blue-300' : 'text-blue-600'} mb-2`}>Ground Services</p>
<div className="space-y-1">
{selectedEntity.backupServices.groundServices.map((svc, idx) => svc.name && (
<div key={idx} className={`text-sm ${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>
{svc.name} {svc.phone && `- ${svc.phone}`}
</div>
))}
</div>
</div>
)}
</div>
</div>
)}

{/* Contractual Obligations */}
{selectedEntity.contractualObligations && selectedEntity.contractualObligations.length > 0 && selectedEntity.contractualObligations[0] && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-2`}>Contractual Obligations</h3>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md space-y-2`}>
{selectedEntity.contractualObligations.map((obligation, idx) => obligation && (
<div key={idx} className={`text-sm ${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>
â€¢ {obligation}
</div>
))}
</div>
</div>
)}

{/* Landing Zones */}
{selectedEntity.type === '911_center' && selectedEntity.flightProgram && selectedEntity.flightProgram.landingZones && selectedEntity.flightProgram.landingZones.length > 0 && selectedEntity.flightProgram.landingZones[0].name && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-2 flex items-center`}>
<Icon type="location" className="mr-2" />
Known Landing Zones
</h3>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md space-y-3`}>
{selectedEntity.flightProgram.landingZones.map((zone, idx) => zone.name && (
<div key={idx} className="border-l-2 border-blue-500 pl-3">
<p className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>{zone.name}</p>
{zone.coordinates && <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Coordinates: {zone.coordinates}</p>}
{zone.description && <p className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{zone.description}</p>}
</div>
))}
</div>
</div>
)}

{/* County Information */}
{selectedEntity.countyInfo && selectedEntity.countyInfo.county && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-2`}>County Information</h3>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md space-y-3`}>
<div>
<p className={`font-medium ${darkMode ? 'text-blue-300' : 'text-blue-600'}`}>{selectedEntity.countyInfo.county}</p>
</div>
{selectedEntity.countyInfo.sheriffAgencies && selectedEntity.countyInfo.sheriffAgencies.length > 0 && selectedEntity.countyInfo.sheriffAgencies[0].name && (
<div>
<p className={`font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-1`}>Sheriff Agencies</p>
<div className="space-y-1">
{selectedEntity.countyInfo.sheriffAgencies.map((agency, idx) => agency.name && (
<div key={idx} className={`text-sm ${darkMode ? 'text-gray-200' : 'text-gray-800'}`}>
{agency.name} {agency.phone && `- ${agency.phone}`}
</div>
))}
</div>
</div>
)}
{selectedEntity.countyInfo.fireAgencies && selectedEntity.countyInfo.fireAgencies.length > 0 && selectedEntity.countyInfo.fireAgencies[0].name && (
<div>
<p className={`font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-1`}>Fire Agencies</p>
<div className="space-y-1">
{selectedEntity.countyInfo.fireAgencies.map((agency, idx) => agency.name && (
<div key={idx} className={`text-sm ${darkMode ? 'text-gray-200' : 'text-gray-800'}`}>
{agency.name} {agency.phone && `- ${agency.phone}`}
</div>
))}
</div>
</div>
)}
{selectedEntity.countyInfo.emsAgencies && selectedEntity.countyInfo.emsAgencies.length > 0 && selectedEntity.countyInfo.emsAgencies[0].name && (
<div>
<p className={`font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-1`}>EMS Agencies</p>
<div className="space-y-1">
{selectedEntity.countyInfo.emsAgencies.map((agency, idx) => agency.name && (
<div key={idx} className={`text-sm ${darkMode ? 'text-gray-200' : 'text-gray-800'}`}>
{agency.name} {agency.phone && `- ${agency.phone}`}
</div>
))}
</div>
</div>
)}
</div>
</div>
)}

{/* Notes */}
{selectedEntity.notes && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-2`}>Notes</h3>
<p className={`${darkMode ? 'bg-gray-700 text-gray-200' : 'bg-gray-50 text-gray-700'} p-3 rounded-md whitespace-pre-wrap`}>{selectedEntity.notes}</p>
</div>
)}
</div>
</div>
) : (
<div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6 text-center`}>
<p className={`${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Select an entity to view details</p>
</div>
)}
</div>
</div>
)
) : activeTab === 'insurance' ? (
// Insurance Portal
<div className="grid grid-cols-1 md:grid-cols-3 gap-6">
<div className="md:col-span-1">
<div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm overflow-hidden`}>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} px-4 py-3 border-b ${darkMode ? 'border-gray-600' : 'border-gray-200'}`}>
<h2 className={`text-lg font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>
Insurance Payors ({filteredPayors.length})
</h2>
</div>
<div className="space-y-1 p-2">
{filteredPayors && filteredPayors.length > 0 ? (
filteredPayors.map((payor, index) => (
<div 
key={payor.id || index} 
className={`p-3 rounded-md cursor-pointer transition-colors ${
selectedPayor && selectedPayor.id === payor.id 
? darkMode ? 'bg-blue-900 border border-blue-700' : 'bg-blue-50 border border-blue-200'
: darkMode ? 'hover:bg-gray-700 border border-transparent' : 'hover:bg-gray-50 border border-transparent'
}`}
onClick={() => setSelectedPayor(payor)}
>
<div className="flex justify-between items-center">
<div>
<div className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>{payor.name}</div>
<div className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} capitalize`}>{payor.type?.replace('_', ' ')}</div>
</div>
{isAdminAuthenticated && (
<div className="flex space-x-1">
<button className={`p-1 transition-colors ${darkMode ? 'text-blue-400 hover:text-blue-300' : 'text-blue-600 hover:text-blue-800'}`} onClick={(e) => { e.stopPropagation(); handleEditPayor(payor); }}><Icon type="edit" /></button>
<button className={`p-1 transition-colors ${darkMode ? 'text-red-400 hover:text-red-300' : 'text-red-600 hover:text-red-800'}`} onClick={(e) => { e.stopPropagation(); handleDeletePayor(payor.id); }}><Icon type="trash" /></button>
</div>
)}
</div>
</div>
))
) : (
<div className={`p-4 text-center ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>No payors found</div>
)}
</div>
</div>
</div>

<div className="md:col-span-2">
{selectedPayor ? (
<div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm overflow-hidden`}>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} px-6 py-4 border-b ${darkMode ? 'border-gray-600' : 'border-gray-200'} flex justify-between items-center`}>
<div>
<h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>{selectedPayor.name}</h2>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} capitalize mt-1`}>{selectedPayor.type?.replace('_', ' ')}</p>
</div>
{isAdminAuthenticated && (
<div className="flex space-x-2">
<button
className={`px-3 py-1.5 rounded-md flex items-center transition-colors ${darkMode ? 'bg-blue-700 text-blue-100 hover:bg-blue-600' : 'bg-blue-100 text-blue-600 hover:bg-blue-200'}`}
onClick={() => handleEditPayor(selectedPayor)}
>
<Icon type="edit" className="mr-1" /> Edit
</button>
<button
className={`px-3 py-1.5 rounded-md flex items-center transition-colors ${darkMode ? 'bg-red-700 text-red-100 hover:bg-red-600' : 'bg-red-100 text-red-600 hover:bg-red-200'}`}
onClick={() => handleDeletePayor(selectedPayor.id)}
>
<Icon type="trash" className="mr-1" /> Delete
</button>
</div>
)}
</div>
<div className="p-6 space-y-6 max-h-[70vh] overflow-y-auto">
{/* Basic Information */}
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-4 rounded-md shadow-sm`}>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 flex items-center text-lg`}>
<Icon type="building" className="mr-2" />
Basic Information
</h3>
<div className="space-y-3">
<div className="flex items-start">
<div className="w-8 flex-shrink-0 flex justify-center">
<Icon type="tag" />
</div>
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Type</p>
<p className={`${darkMode ? 'text-gray-200' : 'text-gray-900'} capitalize`}>{selectedPayor.type?.replace('_', ' ')}</p>
</div>
</div>
{selectedPayor.website && (
<div className="flex items-start">
<div className="w-8 flex-shrink-0 flex justify-center">
<Icon type="globe" />
</div>
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Website</p>
<a 
href={selectedPayor.website} 
target="_blank" 
rel="noopener noreferrer"
className="text-blue-600 hover:text-blue-800 underline break-all"
>
{selectedPayor.website}
</a>
</div>
</div>
)}
</div>
</div>

{/* Phone Numbers */}
{selectedPayor.phoneNumbers && selectedPayor.phoneNumbers.length > 0 && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 flex items-center text-lg`}>
<Icon type="phone" className="mr-2" />
Phone Numbers
</h3>
<div className="space-y-2">
{selectedPayor.phoneNumbers.map((phone, index) => (
<div key={index} className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md`}>
<div className="flex justify-between items-center mb-1">
<span className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>{phone.label || 'Phone'}</span>
<span className="font-mono text-blue-600">{phone.number}</span>
</div>
{phone.description && (
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>{phone.description}</p>
)}
</div>
))}
</div>
</div>
)}

{/* Emergency Ground */}
{selectedPayor.emergencyGround && (selectedPayor.emergencyGround.phone || selectedPayor.emergencyGround.preauth_required || selectedPayor.emergencyGround.notes) && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3`}>Emergency Ground Transport</h3>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-4 rounded-md space-y-2`}>
{selectedPayor.emergencyGround.phone && (
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Phone</p>
<p className={`font-mono text-blue-600`}>{selectedPayor.emergencyGround.phone}</p>
</div>
)}
{selectedPayor.emergencyGround.preauth_required && (
<div className="flex items-center text-orange-600">
<span className="mr-2">âš ï¸</span> Pre-authorization Required
</div>
)}
{selectedPayor.emergencyGround.notes && (
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Notes</p>
<p className={`${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>{selectedPayor.emergencyGround.notes}</p>
</div>
)}
</div>
</div>
)}

{/* Non-Emergency Ground */}
{selectedPayor.nonEmergencyGround && (selectedPayor.nonEmergencyGround.phone || selectedPayor.nonEmergencyGround.preauth_required || selectedPayor.nonEmergencyGround.notes) && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3`}>Non-Emergency Ground Transport</h3>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-4 rounded-md space-y-2`}>
{selectedPayor.nonEmergencyGround.phone && (
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Phone</p>
<p className={`font-mono text-blue-600`}>{selectedPayor.nonEmergencyGround.phone}</p>
</div>
)}
{selectedPayor.nonEmergencyGround.preauth_required && (
<div className="flex items-center text-orange-600">
<span className="mr-2">âš ï¸</span> Pre-authorization Required
</div>
)}
{selectedPayor.nonEmergencyGround.notes && (
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Notes</p>
<p className={`${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>{selectedPayor.nonEmergencyGround.notes}</p>
</div>
)}
</div>
</div>
)}

{/* Rotor Wing */}
{selectedPayor.rotorWing && (selectedPayor.rotorWing.phone || selectedPayor.rotorWing.preauth_required || selectedPayor.rotorWing.notes) && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 flex items-center`}>
<Icon type="plane" className="mr-2" />
Rotor Wing (Helicopter)
</h3>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-4 rounded-md space-y-2`}>
{selectedPayor.rotorWing.phone && (
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Phone</p>
<p className={`font-mono text-blue-600`}>{selectedPayor.rotorWing.phone}</p>
</div>
)}
{selectedPayor.rotorWing.preauth_required && (
<div className="flex items-center text-orange-600">
<span className="mr-2">âš ï¸</span> Pre-authorization Required
</div>
)}
{selectedPayor.rotorWing.notes && (
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Notes</p>
<p className={`${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>{selectedPayor.rotorWing.notes}</p>
</div>
)}
</div>
</div>
)}

{/* Fixed Wing */}
{selectedPayor.fixedWing && (selectedPayor.fixedWing.phone || selectedPayor.fixedWing.preauth_required || selectedPayor.fixedWing.notes) && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 flex items-center`}>
<Icon type="plane" className="mr-2" />
Fixed Wing (Airplane)
</h3>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-4 rounded-md space-y-2`}>
{selectedPayor.fixedWing.phone && (
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Phone</p>
<p className={`font-mono text-blue-600`}>{selectedPayor.fixedWing.phone}</p>
</div>
)}
{selectedPayor.fixedWing.preauth_required && (
<div className="flex items-center text-orange-600">
<span className="mr-2">âš ï¸</span> Pre-authorization Required
</div>
)}
{selectedPayor.fixedWing.notes && (
<div>
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Notes</p>
<p className={`${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>{selectedPayor.fixedWing.notes}</p>
</div>
)}
</div>
</div>
)}

{/* Reference Links */}
{selectedPayor.referenceLinks && selectedPayor.referenceLinks.length > 0 && selectedPayor.referenceLinks[0].url && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3 flex items-center`}>
<Icon type="globe" className="mr-2" />
Reference Links
</h3>
<div className="space-y-2">
{selectedPayor.referenceLinks.map((link, idx) => link.url && (
<div key={idx} className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md`}>
<a 
href={link.url} 
target="_blank" 
rel="noopener noreferrer"
className="text-blue-600 hover:text-blue-800 underline font-medium break-all"
>
{link.title || link.url}
</a>
{link.description && (
<p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mt-1`}>{link.description}</p>
)}
</div>
))}
</div>
</div>
)}

{/* Notes */}
{selectedPayor.notes && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-2`}>Notes</h3>
<p className={`${darkMode ? 'bg-gray-700 text-gray-200' : 'bg-gray-50 text-gray-700'} p-3 rounded-md whitespace-pre-wrap`}>{selectedPayor.notes}</p>
</div>
)}
</div>
</div>
) : (
<div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6 text-center`}>
<p className={`${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Select a payor to view details</p>
</div>
)}
</div>
</div>
) : (
// Directors Tab
directorsLoading ? (
<div className="text-center py-10">
<p className={`${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Loading directory contacts...</p>
</div>
) : (
<div className="grid grid-cols-1 md:grid-cols-3 gap-6">
<div className="md:col-span-1 space-y-6">
{Object.entries(groupedDirectors).length > 0 ? (
Object.entries(groupedDirectors).map(([type, typeDirectors]) => (
<div key={type} className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm overflow-hidden`}>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} px-4 py-3 border-b ${darkMode ? 'border-gray-600' : 'border-gray-200'}`}>
<h2 className={`text-lg font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>
{type} ({typeDirectors.length})
</h2>
</div>
<ul className={`divide-y ${darkMode ? 'divide-gray-700' : 'divide-gray-200'}`}>
{typeDirectors.map(director => (
<li
key={director.id}
className={`px-4 py-3 cursor-pointer entity-card ${
selectedDirector && selectedDirector.id === director.id 
? darkMode ? 'bg-blue-900 bg-opacity-50' : 'bg-blue-50'
: darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-50'
}`}
onClick={() => setSelectedDirector(director)}
>
<div className="flex justify-between items-center">
<div>
<h3 className={`text-sm font-medium ${darkMode ? 'text-white' : 'text-gray-900'}`}>{director.name}</h3>
<p className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{director.title}</p>
</div>
{isAdminAuthenticated && (
<div className="flex space-x-1">
<button
className={`p-1 transition-colors ${darkMode ? 'text-blue-400 hover:text-blue-300' : 'text-blue-600 hover:text-blue-800'}`}
onClick={(e) => {
e.stopPropagation();
handleEditDirector(director);
}}
>
<Icon type="edit" />
</button>
<button
className={`p-1 transition-colors ${darkMode ? 'text-red-400 hover:text-red-300' : 'text-red-600 hover:text-red-800'}`}
onClick={(e) => {
e.stopPropagation();
handleDeleteDirector(director.id);
}}
>
<Icon type="trash" />
</button>
</div>
)}
</div>
</li>
))}
</ul>
</div>
))
) : (
<div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6 text-center`}>
<p className={`${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>No directory contacts found matching your search.</p>
</div>
)}
</div>

<div className="md:col-span-2">
{selectedDirector ? (
<div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm`}>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} px-6 py-4 border-b ${darkMode ? 'border-gray-600' : 'border-gray-200'} flex justify-between items-center`}>
<h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-900'}`}>{selectedDirector.name}</h2>
<div className="flex space-x-2">
{isAdminAuthenticated && (
<>
<button
className={`px-3 py-1.5 rounded-md flex items-center transition-colors ${darkMode ? 'bg-blue-700 text-blue-100 hover:bg-blue-600' : 'bg-blue-100 text-blue-600 hover:bg-blue-200'}`}
onClick={() => handleEditDirector(selectedDirector)}
>
<Icon type="edit" className="mr-1" /> Edit
</button>
<button
className={`px-3 py-1.5 rounded-md flex items-center transition-colors ${darkMode ? 'bg-red-700 text-red-100 hover:bg-red-600' : 'bg-red-100 text-red-600 hover:bg-red-200'}`}
onClick={() => handleDeleteDirector(selectedDirector.id)}
>
<Icon type="trash" className="mr-1" /> Delete
</button>
</>
)}
</div>
</div>
<div className="p-6 space-y-6">
<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-4 rounded-md`}>
<p className={`text-sm font-medium ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Title</p>
<p className={`${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>{selectedDirector.title}</p>
</div>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-4 rounded-md`}>
<p className={`text-sm font-medium ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Department</p>
<p className={`${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>{selectedDirector.department || 'Not specified'}</p>
</div>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-4 rounded-md`}>
<p className={`text-sm font-medium ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Type</p>
<p className={`${darkMode ? 'text-gray-200' : 'text-gray-900'}`}>{selectedDirector.type}</p>
</div>
<div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-4 rounded-md`}>
<p className={`text-sm font-medium ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Email</p>
<p className={`${darkMode ? 'text-gray-200' : 'text-gray-900'} break-all`}>{selectedDirector.email || 'Not specified'}</p>
</div>
</div>

{selectedDirector.phoneNumbers && selectedDirector.phoneNumbers.length > 0 && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3`}>Phone Numbers</h3>
<div className="space-y-2">
{selectedDirector.phoneNumbers.map((phone, idx) => (
<div key={idx} className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md`}>
<div className="flex justify-between">
<span className={`font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{phone.label || 'Phone'}</span>
<span className="font-mono text-blue-600">{phone.number}</span>
</div>
</div>
))}
</div>
</div>
)}

{selectedDirector.extensions && selectedDirector.extensions.length > 0 && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-3`}>Extensions</h3>
<div className="space-y-2">
{selectedDirector.extensions.map((ext, idx) => (
<div key={idx} className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'} p-3 rounded-md`}>
<div className="flex justify-between">
<span className={`font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{ext.label || 'Ext'}</span>
<span className="font-mono">{ext.number}</span>
</div>
</div>
))}
</div>
</div>
)}

{selectedDirector.notes && (
<div>
<h3 className={`font-medium ${darkMode ? 'text-white' : 'text-gray-900'} mb-2`}>Notes</h3>
<p className={`${darkMode ? 'bg-gray-700 text-gray-200' : 'bg-gray-50 text-gray-700'} p-4 rounded-md`}>{selectedDirector.notes}</p>
</div>
)}
</div>
</div>
) : (
<div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6 text-center`}>
<p className={`${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>Select a contact to view details</p>
</div>
)}
</div>
</div>
)
)}
</main>

{/* Admin Modal */}
{showAdmin && (
<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
<div className="w-full max-w-4xl max-h-[90vh] overflow-auto">
{activeTab === 'entities' ? (
<EntityForm 
entity={entityToEdit} 
onSave={handleSaveNewEntity} 
onCancel={() => {
setShowAdmin(false);
setEntityToEdit(null);
}} 
/>
) : activeTab === 'insurance' ? (
<PayorForm 
payor={payorToEdit} 
onSave={handleSaveNewPayor} 
onCancel={() => {
setShowAdmin(false);
setPayorToEdit(null);
}} 
/>
) : (
<DirectorForm 
director={directorToEdit} 
onSave={handleSaveNewDirector} 
onCancel={() => {
setShowAdmin(false);
setDirectorToEdit(null);
}} 
/>
)}
</div>
</div>
)}

{/* Admin Password Modal */}
<PasswordModal 
isOpen={showAdminPasswordModal}
onClose={() => setShowAdminPasswordModal(false)}
onSubmit={handleAdminPasswordSubmit}
title="Admin Access Required"
message="Please enter the admin password to access management features."
/>
</div>
);
};

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<EmergencyPortal />);
</script>
</body>
<footer>
<small>&copy; 2025 Haynes Communications Dispatch Reference Portal. All rights reserved.</small>
</footer>
</html>
